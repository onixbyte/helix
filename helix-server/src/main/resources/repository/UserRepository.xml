<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.onixbyte.helix.repository.UserRepository">
    <update id="update">
        UPDATE users
        <set>
            <if test="user.username != null">
                username = #{user.username},
            </if>
            <if test="user.fullName != null">
                full_name = #{user.fullName},
            </if>
            <if test="user.email != null">
                email = #{user.email},
            </if>
            <if test="user.countryCode != null">
                country_code = #{user.countryCode},
            </if>
            <if test="user.phoneNumber != null">
                phone_number = #{user.phoneNumber},
            </if>
            <if test="user.avatarUrl != null">
                avatar_url = #{user.avatarUrl},
            </if>
            <if test="user.status != null">
                status = #{user.status},
            </if>
            <if test="user.departmentId != null">
                department_id = #{user.departmentId},
            </if>
            <if test="user.positionId != null">
                position_id = #{user.positionId},
            </if>
            <if test="user.updatedAt != null">
                updated_at = #{user.updatedAt},
            </if>
        </set>
        WHERE id = #{user.id}
    </update>
    <select id="selectByUsername" parameterType="string">
        SELECT id,
               username,
               password,
               full_name,
               email,
               country_code,
               phone_number,
               avatar_url,
               status,
               department_id,
               position_id,
               created_at,
               updated_at
        FROM users
        WHERE username = #{username}
    </select>

    <select id="selectAll" parameterType="org.springframework.data.domain.Pageable"
            resultType="user">
        SELECT id,
               username,
               password,
               full_name,
               email,
               country_code,
               phone_number,
               avatar_url,
               status,
               department_id,
               position_id,
               created_at,
               updated_at
        FROM users
        <if test="pageable != null and pageable.sort != null">
            ORDER BY
            <foreach collection="pageable.sort" item="order" separator=", ">
                ${order.property} ${order.direction}
            </foreach>
            LIMIT #{pageable.pageSize} OFFSET #{pageable.offset}
        </if>
    </select>

    <select id="countAll" resultType="int">
        SELECT COUNT(*)
        FROM users
    </select>

    <select id="selectList" resultType="user">
        SELECT id,
               username,
               password,
               full_name,
               email,
               country_code,
               phone_number,
               avatar_url,
               status,
               department_id,
               position_id,
               created_at,
               updated_at
        FROM users
        <where>
            <if test="request != null and request.departmentId != null">
                department_id = #{request.departmentId}
            </if>
        </where>
        <if test="pageable != null and pageable.sort != null">
            ORDER BY
            <foreach collection="pageable.sort" item="order" separator=", ">
                ${order.property} ${order.direction}
            </foreach>
            LIMIT #{pageable.pageSize} OFFSET #{pageable.offset}
        </if>
    </select>

    <select id="count" resultType="int">
        SELECT COUNT(*)
        FROM users
        <where>
            <if test="request != null and request.departmentId != null">
                department_id = #{request.departmentId}
            </if>
        </where>
    </select>

    <insert id="save" parameterType="user">
        INSERT INTO users(id, username, password, full_name, email, country_code, phone_number,
                          avatar_url, status, department_id, position_id, created_at, updated_at)
        VALUES (#{user.id}, #{user.username}, #{user.password}, #{user.fullName}, #{user.email},
                #{user.countryCode}, #{user.phoneNumber}, #{user.avatarUrl}, #{user.status},
                #{user.departmentId}, #{user.positionId}, #{user.createdAt}, #{user.updatedAt})
    </insert>

    <select id="selectById" parameterType="long" resultType="user">
        SELECT id,
               username,
               password,
               full_name,
               email,
               country_code,
               phone_number,
               avatar_url,
               status,
               department_id,
               position_id,
               created_at,
               updated_at
        FROM users
        WHERE id = #{id}
    </select>
</mapper>